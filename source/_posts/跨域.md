---
title: 跨域
date: 2017-10-04 15:32:33
tags: 技术博客
---
## 什么是同源策略
同源策略是指浏览器为了防止非同源网址使用Ajax导致的安全隐患而采取的禁止调用非同源网址的Ajax请求的策略。
同源网址有三大特征：
1. 协议相同
2. 网址相同
3. 端口相同

## 什么是跨域？跨域有几种实现形式
跨域是指绕过同源策略，使得不同源间的网址可以相互做出Ajax请求（或者达到类似Ajax请求的效果）的方式。
跨域一般有四种实现方式。
1. JSONP
2. CORS
3. 降域
4. PostMessage

## JSONP 的原理是什么
JSONP是指将请求返回的数据包装成JS可执行函数的形式，将真实数据作为参数传入此函数中，从而使用script标签来获取数据的方式。本质上来讲script标签获取脚本并非Ajax，所以不受同源策略影响。
## CORS是什么
CORS是指在后端对请求添加Access-Control-Allow-Origin头，在现代浏览器中，只要Access-Control-Allow-Origin头包含发起请求的域，则将此次请求视为“跨域资源共享”，允许跨域。
## 演示三种以上跨域的解决方式
### CORS跨域
以我的曾经一个小Demo“十条评论区”的后端PHP代码为例：
{% codeblock lang:php %}
<?php
  header('Access-Control-Allow-Origin:http://comment.zain.red');header("Content-Type: text/html;charset=utf-8");
{% endcodeblock %}
只要在代码头加入Access-Control-Allow-Origin，值为允许的网址，即可实现跨域资源共享。
### JSONP跨域
{% codeblock lang:html %}
  <--! 前端代码 -->
  <script>
    var printfData = function(data){
      console.log(data);
    }
  </script>
  <script src="http://a.zain.red/data?callback=printfData"></script>
{% endcodeblock %}
{% codeblock lang:php %}
/* 后端代码 */

<?php
$result = "我是数据";  
$callback = $_GET['callback'];  
echo $callback."($result)";  
{% endcodeblock %}

### 降域实现iframe跨域
在使用iframe时，可通过定义document.domain实现降域。
{% codeblock lang:html %}
  <--! http://zain.red/index.html-->
  <iframe src="http://a.zain.red/data.html"></iframe>
{% endcodeblock %}
{% codeblock lang:html %}
  <--! http://a.zain.red/index.html-->
  <div>12342234</div>
  <script>
    document.domain = "zain.red";
  </script>
{% endcodeblock %}
*本文章著作权由Zainking与饥人谷所有，转载请著明出处*
