---
title: 前端性能优化
date: 2017-11-28 14:28:04
tags: 技术博客
---
前端性能优化设计很多方面，今天准备写一篇文章做一个纵览的总结。
文章会从 程序性能优化 资源分配优化 传输性能优化 用户体验优化四个大的角度来解析前端性能优化。
## 程序性能优化

当代前端有两大驱动的开发模式，分别是以DOM为驱动的传统开发模式和以数据为驱动的MVVM开发模式;这两种开发模式分别面临着各自的性能优化问题，除了针对这两种开发模式的性能优化之外还有一些编程细节的性能优化方法。

### 以DOM为驱动的性能优化：减少或合并DOM操作

众所周知，DOM操作是前端程序中最耗费资源的编程操作。示例代码如下：
{% codeblock lang:javascript %}
// 不好的方式
//var elem = $('#elem');
//for (var i = 0; i < 100; i++) {
//  elem.append('<li>element '+i+'</li>');
//}

// 好的方式
var elem = $('#elem' ),
arr = [];
for (var i = 0;  i < 100; i++) {
  arr.push('<li>element ' +i+'</li>' );
}
elem.append(arr. join(''));
{% endcodeblock %}
事实上，最新的MVVM框架纷纷对自家的文档操作中实现了虚拟DOM，通过Diff算法来减少真实DOM操作的压力。

### 以数据为驱动的性能优化：优化数据结构

前端MVVM框架以数据为驱动进行开发，则需要对问题抽象出合适的逻辑结构，选择合适的数据结构，再通过高效的算法实现。
比如在实际项目中尽量不要使用以前算法课上学的“冒泡排序 选择排序”，而使用Array.prototype.sort()方法，以V8引擎为例，不严谨的说，它的算法跟数组的长度有关，当数组长度小于等于 10 时，采用插入排序，大于 10 的时候，采用快速排序。时间复杂度在最好的情况下可以达到O(n).

### 其他一些细节：对大量重复事件使用事件代理 对大量数据计算使用缓存 减少无必要的大量触发事件操作等

如一篇我以前文章[事件](https://blog.zain.red/2017/09/29/%E4%BA%8B%E4%BB%B6/)中所提到的事件代理机制，绑定一个元素使用事件代理比绑定100个小事件更加节约性能。
又有如下例子：
{% codeblock lang:javascript %}
// data.length === 100000
for(var i = 0;i < data.length;i++){
  // do something...
}
//上面的代码没有下面的好
for(var i = 0,len = data.length;i < len;i++){
  // do something...
}
{% endcodeblock %}
因为data.length在源代码中是通过.next()方法一个一个数出来的，所以可以把它赋值给一个缓存len,以后每次重复需要这个量的时候只需要调用缓存就行了。
还有一些情况，常见于触发滚动事件时，滚动事件每滚动一个像素就会触发一次，为了防止它过于频繁的触发，常常使用setTimeout()方法来降低它调用的频率，每隔一定时间段才触发。

## 资源分配优化

上海交通大学杨斌老师的《软件工程》课程指出，现代软件发展瓶颈之一在于网络传输速度的瓶颈。这也就意味着在我们设计前端工程的时候要考虑如何根据线性的网络传输速度平均分配资源的展现量来缓解用户的焦虑————事实上这样做如果加载的是动态资源还有助于缓解服务器压力，从未来的角度思考，甚至可能帮助缓解客户端内存和磁盘读写压力。

### 分页 懒加载

### 单页应用基于路由的懒加载

### 预加载

## 传输性能优化
前端工程的最典型特征在于他是异步的，互联网化的，所以针对‘传输’这一关键点进行优化往往是最直接，最有效的方法。

### 选择合适的通信协议

### 压缩合并资源：减小请求内容大小和请求数

### 使用CDN传输静态资源

### 启用服务器压缩方案：gzip等

### 采用合适的缓存方案

## 用户体验优化
通过良好的设计虽然不能直接提高软件性能，但是可以有效的缓解用户焦虑，提高即时数据利用率等。

### 采用进度条等手段解决“无响应错觉”

### 采用提前展现内容等方法

### 预加载

### 优秀的交互设计

## 综合优化策略————优先补充短板
一只木桶能盛多少水，并不取决于最长的那块木板，而是取决于最短的那块木板。也可称为短板效应。任何一个前端架构，可能面临的一个共同问题，即构成工程的各个部分往往是优劣不齐的，而劣势部分往往决定整个工程的水平。因此，每个人都应思考一下“短板”的位置，并尽早补足它。
## 附：前端性能测试工具网站
[WebPageTest](http://www.webpagetest.org/)
[谷歌的性能测试网站](https://developers.google.com/speed/pagespeed/insights/)
