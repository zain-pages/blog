---
title: 文件编码探幽
date: 2018-03-27 17:17:25
tags: 技术博客
---
写这篇文章，是因为在阅读《深入理解计算机系统》时候，在它的第一章第一节看到这么一段话
> Files such as hello.c that consist exclusively of ASCII characters are known as text files. All other files are known as binary files.

这句话核心逻辑就是：`ANSI`编码的文件叫做`文本文件`，其他所有文件都叫做`二进制文件`。
初读这句话感觉十分不可思议，因为对界定逻辑比较敏感所以觉得`文本文件`、`二进制文件`与`ANSI`文件、`非ANSI文件`无论是定义还是应用语境皆有不同，于是我开始了下面的详细探寻。

首先思考，ANSI`文件、`非ANSI文件的界定是很清晰的——以`ANSI`为编码格式存储的文件称之为ANSI文件，反之称之为非ANSI文件。应用场景也很清晰：需要辨明文件编码格式的时候。

那么问题就出在了`文本文件`、`二进制文件`的定义和应用范围问题上。

首先上维基百科二者定义：
> 文本文件一般指只有字符原生编码构成的二进制计算机文件，与富文本相比，其不包含字样样式的控制元素，能够被最简单的文本编辑器直接读取。
> 二进制文件（英语：Binary file）一般指包含ASCLL及扩展ASCII字符中编写的数据或程序指令（Program instructions）的文件。广义的二进制文件即为文件，由文件在外部存储设备的存放方式为二进制而得名。狭义的二进制文件即指除文本文件以外的文件。

看得出来《深》书之描述更接近于狭义的定义: 文本文件以外的文件是二进制文件。但是此定义又与《深》书不同：`ANSI编码文件`在维基百科的定义上不等于`文本文件`。

读书解意，既然定义有所不同，那么需要辨明他们为什么不同，才能减轻记忆负担和深入理解问题。

那么辨意的第一步就是明白`文本文件`和`二进制文件`的应用场景有哪些。

谷歌搜索`文本文件 二进制文件`，以前三个结果进行综合分析。
2018 年 3 月 27 日按照上述关键词以香港谷歌进行检索，返回的前三个结果分别来源于`知乎`，`博客园`，`简书`。
鉴于结果来源社区全都是技术氛围比较浓厚的社区，于是决定都点进去看看。

知乎答案第一名67赞，中心思想为`二进制文件`和`文本文件`都是以二进制方式存储，他们的读取方式由文件头决定。
不愧是逼乎，人家问区别，你回答没什么区别。虽然增长了知识但是对于我们的问题没有任何直接帮助。

知乎答案第二名31赞，中心思想为`二进制文件`的实质是它`含有文件的内容信息和解释方式`，而`二进制文件`仅仅拥有控制信息和内容，不提供让你直接解读的途径。

接下来分别看看博客园和简书上的两篇高排名博文。

博客园中的博客分别以二者定义，文件存取，优缺点，C语言的二进制和文本方式读写，实例五个方面介绍了文本文件和二进制文件。
而其中的实例则证明C语言在进行写文件操作时，仅仅对`文本文件`多进行一些转换，实质上文件内容仅仅是增加了一些编码内容而已，从侧面重新论述了知乎排名第一的人的言论。

而简书上的那篇博文则直接举出了`文本文件`和`二进制文件`的四点区别，也最能解决疑惑：

> 文本文件基本上是定长编码的(也有非定长的编码如UTF-8)，基于字符，每个字符在具体编码中是固定的，ASCII码是8个比特的编码，UNICODE一般占16个比特。而二进制文件可看成是变长编码的，因为是值编码，多少个比特代表一个值，完全由自己决定。

`文本文件`依照字符为单位，大多数为定长编码。而`二进制文件`并不要求依照字符（这体现在前几篇文章中无格式、不存在解释方式等表象上）进行存储。

那么我们可以归纳出`文本文件`和`二进制文件`的使用语境：他们大多数用来辨析某个文件能否被人直接以某种编码进行有格式的读取：`文本文件`可以，`二进制文件`往往不行。

问题大致至此可以解决：《深》书的描述不够准确，因为当前文本的编码格式不仅仅有`ANSI`，流行的方案还有`UTF-8`,`UTF-16`等等，所有以文本编码存储的文件都可以称之为`文本文件`。

另外，还有一些很有用的关于编码的知识：
1. 现代文本文件存储往往使用UTF-8编码进行，UTF系列编码是Unicode字符集下的一系列编码规则。
2. 字符集为每一个字符指定了一个唯一的码位，有`Unicode`，`ASCLL`等，大多数`ANSI`编码基于`ASCLL`字符集。
3. 编码规则将每一个码位转换为字符序列。
4. `UTF-8`编码是可变长编码，也就是说存储一个字符用到的存储空间可能不一样长，这样做是为了节省空间。
5. JavaScript使用的编码是`UCS-2`编码，所有字符在JavaScript中都是2个字节，如果是4个字节的字符，会被当做两个双字节的字符处理（知乎就有些字符因此无法显示），ES6增加了对双字节`Unicode`码的支持，但是写程序时还要做一些特殊的处理才能够正确显示，详细请阅读参考资料。

参考资料
---
* 知乎：[文本文件和二进制文件的区别？请举例说明。](https://www.zhihu.com/question/19971994)
* 博客园：[文本文件与二进制文件区别](http://www.cnblogs.com/zhangjiankun/archive/2011/11/27/2265184.html)
* 简书：[文本文件和二进制文件的差异和区别](https://www.jianshu.com/p/af0b4f8b030e)
* 阮一峰博客：[Unicode与JavaScript详解](http://www.ruanyifeng.com/blog/2014/12/unicode.html)
* 另参考维基百科相关条目，《深入理解计算机系统》第二版